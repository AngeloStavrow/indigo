{{ partial "header.html" . }}
{{ $baseurl := .Site.BaseURL | sanitizeurl }}
{{ $author := .Site.Params.Author }}
{{ if .Params.Author }}
    {{ $author = .Params.Author }}
{{ end }}
<div id="content">
    <article class="h-entry">
        <header>
            <h1 class="post-title p-name">{{ .Title }}</h1>
            {{ if not .Params.Menu }}
            <p class="post-date">Posted on
                <time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" | safeHTML }}">
                {{ .PublishDate.Format "2 January, 2006 at 15:04 MST" }}
                </time> {{ if $author }} by <a href="{{ .Site.BaseURL }}" class="p-author h-card" rel="author">{{ $author }}</a>{{ end }}
            </p>
            {{ end }}
            {{ if .Params.categories }}
            <p class="post-tag">Category: 
                {{ range .Params.categories }}
                <a href="{{ $baseurl }}/categories/{{ . | urlize }}" class="post-tag p-category">{{ . }}</a>
                {{ end }}
            </p>
            <hr class="post-underline">
            {{ end }}
        </header>
        <section class="content e-content">
            {{ .Content }}
        </section>
        <script>
            function injectcomments(data) {
                var i;
                for (i = 0; i < data.links.length; i++) {
                    var date = new Date(data.links[i].data.published);
                    document.getElementById('comments').innerHTML += `<div class="comment"><span class="comment-author"><img src="${data.links[i].data.author.photo}" class="comment-author-avatar"></img><a class="comment-author-name" href="${data.links[i].data.author.url}">${data.links[i].data.author.name}</a><p class="comment-time"><a href="${data.links[i].data.url}">replied</a> at ${date.toLocaleString("en-US")}:</p><div class="comment-content">${data.links[i].data.content}</div></div>`;
                }
            }
            $(function(){
                $.getJSON("https://webmention.io/api/mentions?jsonp=?", {
                    target: '{{ .Permalink }}',
                    "wm-property": "in-reply-to"
                }, injectcomments);
            });
        </script>
        <form method="post" action="https://webmention.io/fireburn.ru/webmention">
            <p>Have you published a response to this? <label for="webmention-source">Let me know the <abbr title="Uniform Resource Locator">URL</abbr></label>:</p>
            <input type="url" name="source" id="webmention-source">
            <input type="hidden" name="target" value="{{ .Permalink }}">
            <button type="submit">Ping!</button>
        </form>
        <div id="comments">          </div>
        <footer>
            <a class="permalink u-url" href="{{ .Permalink }}">{{ .Site.Params.PermalinkText }}</a>
            {{ if .Params.tags }}
            <hr class="post-underline">
            <p class="post-tag">Tags for this post: 
            {{ range .Params.tags }}
                <a href="{{ $baseurl }}/tags/{{ . | urlize }}" class="post-tag p-category">{{ . }}</a>
            {{ end }}
            </p>
            {{ end }}
        </footer>
    </article>
</div>
{{ partial "footer.html" . }}
